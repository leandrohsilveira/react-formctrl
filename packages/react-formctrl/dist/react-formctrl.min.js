"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Field=void 0;var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_propTypes=require("prop-types"),_propTypes2=_interopRequireDefault(_propTypes),_provider=require("../provider/provider"),Field=exports.Field=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.state={valid:!0,invalid:!1,untouched:!0,touched:!1,pristine:!0,dirty:!1,unchanged:!0,changed:!1,errors:[],value:"",initialValue:e.initialValue||"",props:{name:e.name,form:e.form,type:e.type,required:e.required,pattern:e.pattern,match:e.match,integer:e.integer,min:e.min,max:e.max,minLength:e.minLength,maxLength:e.maxLength,validate:e.validate}},r.onChange=r.onChange.bind(r),r.handleFieldChangeForward=r.handleFieldChangeForward.bind(r),r.handleChange=r.handleChange.bind(r),r.handleBlur=r.handleBlur.bind(r),r.getChildProps=r.getChildProps.bind(r),r.inject=r.inject.bind(r),r}return _inherits(t,e),_createClass(t,[{key:"componentWillMount",value:function(){var e=this.props,t=e.form,r=e.name,n=e.children;if(Array.isArray(n)&&n.length>1)throw'The Field component for "'+t+"#"+r+'" should have only one child, but has '+n.length+".";document.addEventListener(_provider.REACT_FORMCTRL.EVENTS.FIELD_CHANGED+"#"+t+"#"+r,this.handleFieldChangeForward),_provider.FormEventDispatcher.dispatchRegisterField(t,r,this.state)}},{key:"componentWillUnmount",value:function(){var e=this.props,t=e.form,r=e.name;document.removeEventListener(_provider.REACT_FORMCTRL.EVENTS.FIELD_CHANGED+"#"+t+"#"+r,this.handleFieldChangeForward),_provider.FormEventDispatcher.dispatchUnregisterField(t,r)}},{key:"onChange",value:function(e){var t=this.props.onChange;"function"==typeof t&&t(e)}},{key:"handleFieldChangeForward",value:function(e){var t=e.detail.fieldCtrl;this.setState(t),this.onChange(t)}},{key:"handleChange",value:function(e){this.sync;var t=this.props,r=t.form,n=t.name,i=e.target.value;_provider.FormEventDispatcher.dispatchFieldChanged(r,n,i)}},{key:"handleBlur",value:function(e){if(this.state.untouched){var t=this.props,r=t.form,n=t.name;_provider.FormEventDispatcher.dispatchFieldBlur(r,n,_extends({},this.state,{touched:!0,untouched:!1}))}}},{key:"getChildProps",value:function(){var e={};return e.name=this.props.name,e.formName=this.props.form,e.ctrl={valid:this.state.valid,invalid:this.state.invalid,untouched:this.state.untouched,touched:this.state.touched,pristine:this.state.pristine,dirty:this.state.dirty,unchanged:this.state.unchanged,changed:this.state.changed,errors:this.state.errors},e.className=this.props.className,e.value=this.state.value,e.required=this.props.required,e.pattern=this.props.pattern,e.type=this.props.type||"text",e.onChange=this.handleChange,e.onBlur=this.handleBlur,e}},{key:"inject",value:function(){var e=this.props.inject,t=this.getChildProps();return"function"==typeof e?e(t):t}},{key:"render",value:function(){var e=this.inject,t=this.props.children,r=t;return Array.isArray(t)&&(r=t[0]),_react2.default.cloneElement(r,_extends({},r.props,e()))}}]),t}(_react2.default.Component);Field.propTypes={name:_propTypes2.default.string.isRequired,form:_propTypes2.default.string.isRequired,className:_propTypes2.default.string,required:_propTypes2.default.bool,pattern:_propTypes2.default.oneOfType([_propTypes2.default.string,_propTypes2.default.instanceOf(RegExp)]),type:_propTypes2.default.string,integer:_propTypes2.default.bool,inject:_propTypes2.default.func,match:_propTypes2.default.string,min:_propTypes2.default.oneOfType([_propTypes2.default.number,_propTypes2.default.string]),max:_propTypes2.default.oneOfType([_propTypes2.default.number,_propTypes2.default.string]),minLength:_propTypes2.default.oneOfType([_propTypes2.default.number,_propTypes2.default.string]),maxLength:_propTypes2.default.oneOfType([_propTypes2.default.number,_propTypes2.default.string]),validate:_propTypes2.default.arrayOf(_propTypes2.default.oneOfType([_propTypes2.default.string,_propTypes2.default.shape({name:_propTypes2.default.string.isRequired,params:_propTypes2.default.any})]))},Object.defineProperty(exports,"__esModule",{value:!0}),exports.FormControl=exports.Form=void 0;var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_react2=_interopRequireDefault(_react=require("react")),_propTypes2=_interopRequireDefault(_propTypes=require("prop-types")),_provider=require("../provider/provider"),Form=exports.Form=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.state={ref:1e18*Math.random()+"-"+(new Date).getTime()},r.handleSubmit=r.handleSubmit.bind(r),r.handleReset=r.handleReset.bind(r),r.handleFormSubmitForward=r.handleFormSubmitForward.bind(r),r}return _inherits(t,e),_createClass(t,[{key:"handleSubmit",value:function(e){var t=this.props.name,r=this.state.ref;e.preventDefault(),_provider.FormEventDispatcher.dispatchSubmitForm(t,r)}},{key:"handleReset",value:function(e){var t=this.props.name;e.preventDefault(),_provider.FormEventDispatcher.dispatchResetForm(t)}},{key:"componentWillMount",value:function(){var e=this.props.name;document.addEventListener(_provider.REACT_FORMCTRL.EVENTS.FORM_SUBMITED+"#"+e,this.handleFormSubmitForward),_provider.FormEventDispatcher.dispatchRegisterForm(e)}},{key:"handleFormSubmitForward",value:function(e){var t=this.props.onSubmit;if("function"==typeof t){var r=e.detail,n=r.values,i=r.formCtrl;r.formRef==this.state.ref&&t(n,i)}}},{key:"componentWillUnmount",value:function(){var e=this.props.name;document.removeEventListener(_provider.REACT_FORMCTRL.EVENTS.FORM_SUBMITED+"#"+e,this.handleFormSubmitForward),_provider.FormEventDispatcher.dispatchUnregisterForm(e)}},{key:"render",value:function(){var e=this.handleSubmit,t=this.handleReset,r=this.props,n=r.name,i=r.children,o=r.className;return _react2.default.createElement("form",{id:n,name:n,className:o,onSubmit:e,onReset:t,noValidate:!0},i)}}]),t}(_react2.default.Component);Form.propTypes={name:_propTypes2.default.string.isRequired,className:_propTypes2.default.string,onSubmit:_propTypes2.default.func};var FormControl=exports.FormControl=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.state={valid:!0,invalid:!1,untouched:!0,touched:!1,pristine:!0,dirty:!1,unchanged:!0,changed:!1,fields:{},values:{}},r.onChange=r.onChange.bind(r),r.handleFormChanged=r.handleFormChanged.bind(r),r.sync=r.sync.bind(r),r.inject=r.inject.bind(r),r.setFieldValue=r.setFieldValue.bind(r),r}return _inherits(t,e),_createClass(t,[{key:"componentWillMount",value:function(){var e=this.props,t=e.form,r=e.children;if(Array.isArray(r)&&r.length>1)throw'The FormControl component for "'+t+'" should have only one child, but has '+r.length+".";document.addEventListener(_provider.REACT_FORMCTRL.EVENTS.FORM_CHANGED+"#"+t,this.handleFormChanged)}},{key:"componentWillUnmount",value:function(){var e=this.props.form;document.removeEventListener(_provider.REACT_FORMCTRL.EVENTS.FORM_CHANGED+"#"+e,this.handleFormChanged)}},{key:"onChange",value:function(e){var t=this.props.onChange;"function"==typeof t&&t(e)}},{key:"handleFormChanged",value:function(e){var t=e.detail,r=(this.props.form,t.formCtrl),n=this.sync(r);Object.keys(n).length>0&&(this.setState(r),this.onChange(r))}},{key:"sync",value:function(e){var t={};return JSON.stringify(this.state.values)!==JSON.stringify(e.values)&&(t.values=e.values),JSON.stringify(this.state.fields)!==JSON.stringify(e.fields)&&(t.fields=e.fields),this.state.valid!==e.valid&&(t.valid=e.valid),this.state.invalid!==e.invalid&&(t.invalid=e.invalid),this.state.untouched!==e.untouched&&(t.untouched=e.untouched),this.state.touched!==e.touched&&(t.touched=e.touched),this.state.pristine!==e.pristine&&(t.pristine=e.pristine),this.state.dirty!==e.dirty&&(t.dirty=e.dirty),this.state.unchanged!==e.unchanged&&(t.unchanged=e.unchanged),this.state.changed!==e.changed&&(t.changed=e.changed),t}},{key:"setFieldValue",value:function(e,t){var r=this.props.form;_provider.FormEventDispatcher.dispatchFieldChanged(r,e,t)}},{key:"inject",value:function(){var e=this.props,t=e.inject,r=e.form,n=_extends({},this.state,{formName:r,setFieldValue:this.setFieldValue});return"function"==typeof t?t(n):{formCtrl:n}}},{key:"render",value:function(){var e=this.props.children,t=e;return Array.isArray(e)&&(t=e[0]),_react2.default.cloneElement(t,_extends({},t.props,this.inject()))}}]),t}(_react2.default.Component);FormControl.propTypes={form:_propTypes2.default.string.isRequired,onChange:_propTypes2.default.func,inject:_propTypes2.default.func},Object.defineProperty(exports,"__esModule",{value:!0});var _provider=require("./provider/provider");Object.defineProperty(exports,"REACT_FORMCTL",{enumerable:!0,get:function(){return _provider.REACT_FORMCTL}}),Object.defineProperty(exports,"FormEventDispatcher",{enumerable:!0,get:function(){return _provider.FormEventDispatcher}}),Object.defineProperty(exports,"FormProvider",{enumerable:!0,get:function(){return _provider.FormProvider}});var _form=require("./form/form");Object.defineProperty(exports,"Form",{enumerable:!0,get:function(){return _form.Form}}),Object.defineProperty(exports,"FormControl",{enumerable:!0,get:function(){return _form.FormControl}});var _field=require("./field/field");Object.defineProperty(exports,"Field",{enumerable:!0,get:function(){return _field.Field}}),Object.defineProperty(exports,"__esModule",{value:!0}),exports.FormProvider=exports.FormEventDispatcher=exports.REACT_FORMCTRL=void 0;var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_react2=_interopRequireDefault(_react=require("react")),_propTypes2=_interopRequireDefault(_propTypes=require("prop-types")),REACT_FORMCTRL_NAME="react-formctl",INTEGER_REGEX=/^-?\d+?$/,FLOAT_REGEX=/^-?\d+(\.\d+)?$/,EMAIL_REGEX=/\S+@\S+\.\S+/,PROVIDER_FLAG=REACT_FORMCTRL_NAME+".FormProvider",REACT_FORMCTRL=exports.REACT_FORMCTRL={EVENTS:{REGISTER_FORM:REACT_FORMCTRL_NAME+".registerForm",UNREGISTER_FORM:REACT_FORMCTRL_NAME+".unregisterForm",REGISTER_FIELD:REACT_FORMCTRL_NAME+".registerField",UNREGISTER_FIELD:REACT_FORMCTRL_NAME+".unregisterField",FORM_CHANGED:REACT_FORMCTRL_NAME+".formChanged",FIELD_CHANGED:REACT_FORMCTRL_NAME+".fieldChanged",FIELD_PROPS_CHANGED:REACT_FORMCTRL_NAME+".fieldPropsChanged",FIELD_BLURRED:REACT_FORMCTRL_NAME+".fieldBlurred",FORM_SUBMITED:REACT_FORMCTRL_NAME+".formSubmited",FORM_RESETED:REACT_FORMCTRL_NAME+".formReseted"}},FormEventDispatcher=exports.FormEventDispatcher=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"copy",value:function(e){return JSON.parse(JSON.stringify(e))}},{key:"dispatchRegisterForm",value:function(t){var r=e.copy({detail:{form:t}}),n=new CustomEvent(REACT_FORMCTRL.EVENTS.REGISTER_FORM,r);document.dispatchEvent(n)}},{key:"dispatchUnregisterForm",value:function(t){var r=e.copy({detail:{form:t}}),n=new CustomEvent(REACT_FORMCTRL.EVENTS.UNREGISTER_FORM,r);document.dispatchEvent(n)}},{key:"dispatchSubmitForm",value:function(t,r){var n=e.copy({detail:{form:t,formRef:r}}),i=new CustomEvent(REACT_FORMCTRL.EVENTS.FORM_SUBMITED,n);document.dispatchEvent(i)}},{key:"dispatchResetForm",value:function(t){var r=e.copy({detail:{form:t}}),n=new CustomEvent(REACT_FORMCTRL.EVENTS.FORM_RESETED,r);document.dispatchEvent(n)}},{key:"dispatchRegisterField",value:function(t,r,n){var i=e.copy({detail:{form:t,field:r,fieldCtrl:n}}),o=new CustomEvent(REACT_FORMCTRL.EVENTS.REGISTER_FIELD,i);document.dispatchEvent(o)}},{key:"dispatchUnregisterField",value:function(t,r){var n=e.copy({detail:{form:t,field:r}}),i=new CustomEvent(REACT_FORMCTRL.EVENTS.UNREGISTER_FIELD,n);document.dispatchEvent(i)}},{key:"dispatchFieldPropsChanged",value:function(t,r,n){var i=e.copy({detail:{form:t,field:r,props:n}}),o=new CustomEvent(REACT_FORMCTRL.EVENTS.FIELD_PROPS_CHANGED,i);document.dispatchEvent(o)}},{key:"dispatchFieldChanged",value:function(t,r,n){var i=e.copy({detail:{form:t,field:r,value:n}}),o=new CustomEvent(REACT_FORMCTRL.EVENTS.FIELD_CHANGED,i);document.dispatchEvent(o)}},{key:"dispatchFieldBlur",value:function(t,r){var n=e.copy({detail:{form:t,field:r}}),i=new CustomEvent(REACT_FORMCTRL.EVENTS.FIELD_BLURRED,n);document.dispatchEvent(i)}},{key:"forwardSubmitFormEvent",value:function(t,r,n,i){var o=e.copy({detail:{values:r,formCtrl:n,formRef:i}}),a=new CustomEvent(REACT_FORMCTRL.EVENTS.FORM_SUBMITED+"#"+t,o);document.dispatchEvent(a)}},{key:"forwardFieldChangedEvent",value:function(t,r,n){var i=e.copy({detail:{form:t,field:r,fieldCtrl:n}}),o=new CustomEvent(REACT_FORMCTRL.EVENTS.FIELD_CHANGED+"#"+t+"#"+r,i);document.dispatchEvent(o)}},{key:"forwardFormChangedEvent",value:function(t,r){var n=e.copy({detail:{form:t,formCtrl:r}}),i=new CustomEvent(REACT_FORMCTRL.EVENTS.FORM_CHANGED+"#"+t,n);document.dispatchEvent(i)}}]),e}(),FormProvider=exports.FormProvider=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.state={forms:{},customValidators:{}},r.subscribe=r.subscribe.bind(r),r.unsubscribe=r.unsubscribe.bind(r),r.onEvent=r.onEvent.bind(r),r.onRegisterForm=r.onRegisterForm.bind(r),r.onUnregisterForm=r.onUnregisterForm.bind(r),r.onRegisterField=r.onRegisterField.bind(r),r.onUnregisterField=r.onUnregisterField.bind(r),r.onFieldChanged=r.onFieldChanged.bind(r),r.onFieldPropsChanged=r.onFieldPropsChanged.bind(r),r.onFieldBlurred=r.onFieldBlurred.bind(r),r.onFormSubmited=r.onFormSubmited.bind(r),r.onFormReseted=r.onFormReseted.bind(r),r.updateFormCtrl=r.updateFormCtrl.bind(r),r.updateFieldCtrl=r.updateFieldCtrl.bind(r),r}return _inherits(t,e),_createClass(t,[{key:"componentWillMount",value:function(){this.subscribe();var e={customValidators:{}},t=this.props.customValidators;(void 0===t?[]:t).forEach(function(t){e.customValidators[t.name]=t.validate}),this.setState(e)}},{key:"componentWillUnmount",value:function(){this.unsubscribe()}},{key:"subscribe",value:function(){document.addEventListener(REACT_FORMCTRL.EVENTS.REGISTER_FORM,this.onEvent),document.addEventListener(REACT_FORMCTRL.EVENTS.REGISTER_FIELD,this.onEvent),document.addEventListener(REACT_FORMCTRL.EVENTS.UNREGISTER_FORM,this.onEvent),document.addEventListener(REACT_FORMCTRL.EVENTS.UNREGISTER_FIELD,this.onEvent),document.addEventListener(REACT_FORMCTRL.EVENTS.FIELD_CHANGED,this.onEvent),document.addEventListener(REACT_FORMCTRL.EVENTS.FIELD_BLURRED,this.onEvent),document.addEventListener(REACT_FORMCTRL.EVENTS.FIELD_PROPS_CHANGED,this.onEvent),document.addEventListener(REACT_FORMCTRL.EVENTS.FORM_SUBMITED,this.onEvent),document.addEventListener(REACT_FORMCTRL.EVENTS.FORM_RESETED,this.onEvent)}},{key:"onEvent",value:function(e){var t=e.type,r=e.detail,n=REACT_FORMCTRL.EVENTS;switch(t){case n.REGISTER_FORM:this.onRegisterForm(r.form);break;case n.UNREGISTER_FORM:this.onUnregisterForm(r.form);break;case n.REGISTER_FIELD:this.onRegisterField(r.form,r.field,r.fieldCtrl);break;case n.UNREGISTER_FIELD:this.onUnregisterField(r.form,r.field);break;case n.FIELD_CHANGED:this.onFieldChanged(r.form,r.field,r.value);break;case n.FIELD_PROPS_CHANGED:this.onFieldPropsChanged(r.form,r.field,r.props);break;case n.FIELD_BLURRED:this.onFieldBlurred(r.form,r.field);break;case n.FORM_SUBMITED:this.onFormSubmited(r.form,r.formRef);break;case n.FORM_RESETED:this.onFormReseted(r.form)}}},{key:"onRegisterForm",value:function(e){this.setState(function(t){var r=_extends({},t.forms);return r[e]?r[e].__instances++:r[e]={__instances:1,formName:e,validating:!1,valid:!0,invalid:!1,untouched:!0,touched:!1,pristine:!0,dirty:!1,unchanged:!0,changed:!1,fields:{},values:{}},{forms:r}})}},{key:"onRegisterField",value:function(e,t,r){var n=this;this.setState(function(i){if(i.forms[e]){var o=_extends({},i.forms),a=o[e];return a.fields[t]?r.__instances=a.fields[t].__instances+1:r.__instances=1,n.updateFieldCtrl(e,r,r.initialValue),FormEventDispatcher.forwardFieldChangedEvent(e,t,r),a.fields[t]=r,a.values[t]=r.value,n.updateFormCtrl(e,a),{forms:o}}return console.warn('No form instance with name "'+e+'" to register field "'+t+'".'),i})}},{key:"onUnregisterForm",value:function(e){this.setState(function(t){if(t.forms[e]){var r=_extends({},t.forms),n=r[e];return n.__instances>1?n.__instances--:delete r[e],{forms:r}}return t})}},{key:"onUnregisterField",value:function(e,t){this.setState(function(r){if(r.forms[e]&&r.forms[e].fields[t]){var n=_extends({},r.forms),i=n[e],o=i.fields[t];return o.__instances>1?o.__instances--:delete i.fields[t],{forms:n}}return r})}},{key:"onFieldChanged",value:function(e,t,r){var n=this;this.setState(function(i){if(i.forms[e]&&i.forms[e].fields[t]){var o=_extends({},i.forms),a=o[e],s=a.fields[t];return s.dirty=!0,s.pristine=!1,n.updateFieldCtrl(e,s,r),FormEventDispatcher.forwardFieldChangedEvent(e,t,s),a.values||(a.values={}),a.values[t]=r,n.updateFormCtrl(e,a),{forms:o}}return i})}},{key:"onFieldPropsChanged",value:function(e,t,r){var n=this;this.setState(function(i){var o=_extends({},i.forms),a=o[e],s=a.fields[t];return s.props=r,n.updateFieldCtrl(e,s,s.value),FormEventDispatcher.forwardFieldChangedEvent(e,t,s),n.updateFormCtrl(e,a),{forms:o}})}},{key:"onFieldBlurred",value:function(e,t){var r=this;this.setState(function(n){var i=_extends({},n.forms),o=i[e],a=o.fields[t];return a.touched=!0,a.untouched=!1,FormEventDispatcher.forwardFieldChangedEvent(e,t,a),r.updateFormCtrl(e,o),{forms:i}})}},{key:"updateFormCtrl",value:function(e,t){t.validating=!1,t.valid=!0,t.invalid=!1,t.untouched=!0,t.touched=!1,t.pristine=!0,t.dirty=!1,t.unchanged=!0,t.changed=!1,Object.keys(t.fields).forEach(function(e){var r=t.fields[e];r.validating&&(t.validating=!0),r.valid||(t.valid=!1),r.invalid&&(t.invalid=!0),r.untouched||(t.untouched=!1),r.touched&&(t.touched=!0),r.pristine||(t.pristine=!1),r.dirty&&(t.dirty=!0),r.unchanged||(t.unchanged=!1),r.changed&&(t.changed=!0)}),FormEventDispatcher.forwardFormChangedEvent(e,t)}},{key:"createValidationError",value:function(e,t){return{key:e,params:t}}},{key:"updateFieldCtrl",value:function(e,t,r){var n=this,i=[],o=this.state.customValidators,a=void 0===o?{}:o,s=t.initialValue,u=t.props,d=(u.name,u.type),l=void 0===d?"text":d,p=u.required,c=u.pattern,h=u.match,f=u.integer,E=u.min,v=u.max,m=u.minLength,_=u.maxLength,R=u.validate,F=void 0===R?[]:R;if(p&&!r)i.push(this.createValidationError("required"));else if(c&&c instanceof RegExp&&!c.test(r))i.push(this.createValidationError("pattern",{value:r,pattern:c}));else if(c&&!new RegExp(c).test(r))i.push(this.createValidationError("pattern",{value:r,pattern:c}));else if(h){var C=this.state.forms[e];C&&C.values[h]!=r&&i.push(this.createValidationError("match",{value:r,match:h}))}else"email"!==l||EMAIL_REGEX.test(r)||i.push(this.createValidationError("email",{value:r})),"number"===l?(f&&!INTEGER_REGEX.test(r)&&i.push(this.createValidationError("integer",{value:r})),f||FLOAT_REGEX.test(r)||i.push(this.createValidationError("float",{value:r})),E&&+r<E&&i.push(this.createValidationError("min",{value:r,min:E})),v&&+r>v&&i.push(this.createValidationError("max",{value:r,max:v}))):(m&&r&&r.length<m&&i.push(this.createValidationError("minLength",{value:r,minLength:m})),_&&r&&r.length>_&&i.push(this.createValidationError("maxLength",{value:r,maxLength:_}))),F.length&&Object.keys(a).length&&F.forEach(function(e){var t=e,o=_extends({value:r},e.params);"object"===(void 0===e?"undefined":_typeof(e))&&(t=e.name);var s=a[t];s&&!s(r,o)&&i.push(n.createValidationError(t,o))});t.value=r,t.errors=i,t.unchanged=r===s,t.changed=r!==s,t.valid=0===i.length,t.invalid=i.length>0}},{key:"onFormSubmited",value:function(e,t){this.setState(function(r){var n=r.forms[e];return n&&FormEventDispatcher.forwardSubmitFormEvent(e,n.values,n,t),r})}},{key:"onFormReseted",value:function(e){var t=this;this.setState(function(r){var n=_extends({},r.forms)[e];return Object.keys(n.fields).forEach(function(r){var i=n.fields[r];t.updateFieldCtrl(e,i,i.initialValue),i.touched=!1,i.untouched=!0,i.dirty=!1,i.pristine=!0,FormEventDispatcher.forwardFieldChangedEvent(e,r,i),n.values[r]=i.initialValue}),t.updateFormCtrl(e,n),r})}},{key:"unsubscribe",value:function(){document.removeEventListener(REACT_FORMCTRL.EVENTS.REGISTER_FORM,this.onEvent),document.removeEventListener(REACT_FORMCTRL.EVENTS.REGISTER_FIELD,this.onEvent),document.removeEventListener(REACT_FORMCTRL.EVENTS.UNREGISTER_FORM,this.onEvent),document.removeEventListener(REACT_FORMCTRL.EVENTS.UNREGISTER_FIELD,this.onEvent),document.removeEventListener(REACT_FORMCTRL.EVENTS.FIELD_CHANGED,this.onEvent),document.removeEventListener(REACT_FORMCTRL.EVENTS.FIELD_BLURRED,this.onEvent),document.removeEventListener(REACT_FORMCTRL.EVENTS.FIELD_PROPS_CHANGED,this.onEvent),document.removeEventListener(REACT_FORMCTRL.EVENTS.FORM_SUBMITED,this.onEvent),document.removeEventListener(REACT_FORMCTRL.EVENTS.FORM_RESETED,this.onEvent)}},{key:"render",value:function(){return this.props.children}}]),t}(_react2.default.Component);FormProvider.propTypes={customValidators:_propTypes2.default.arrayOf(_propTypes2.default.shape({name:_propTypes2.default.string.isRequired,validate:_propTypes2.default.func.isRequired}))};