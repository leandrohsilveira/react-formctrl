"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function onRegisterForm(e){return{type:REACT_FORMCTRL.EVENTS.REGISTER_FORM,payload:{form:e}}}function onUnregisterForm(e){return{type:REACT_FORMCTRL.EVENTS.UNREGISTER_FORM,payload:{form:e}}}function onSubmitForm(e,t){return{type:REACT_FORMCTRL.EVENTS.FORM_SUBMITED,payload:{form:e,formRef:t}}}function onResetForm(e){return{type:REACT_FORMCTRL.EVENTS.FORM_RESETED,payload:{form:e}}}function onRegisterField(e,t,r){return{type:REACT_FORMCTRL.EVENTS.REGISTER_FIELD,payload:{form:e,field:t,fieldCtrl:(0,_provider2.copyFieldCtrl)(r)}}}function onUnregisterField(e,t){return{type:REACT_FORMCTRL.EVENTS.UNREGISTER_FIELD,payload:{form:e,field:t}}}function onFieldPropsChanged(e,t,r){return{type:REACT_FORMCTRL.EVENTS.FIELD_PROPS_CHANGED,payload:{form:e,field:t,props:(0,_provider2.copyFieldCtrlProps)(r)}}}function onFieldChanged(e,t,r,n){return{type:REACT_FORMCTRL.EVENTS.FIELD_CHANGED,payload:{form:e,field:t,value:r,files:(0,_provider2.copyFiles)(n)}}}function onFieldBlur(e,t){return{type:REACT_FORMCTRL.EVENTS.FIELD_BLURRED,payload:{form:e,field:t}}}function forwardSubmitFormEvent(e,t,r,n){var o={detail:{values:t,formRef:n,formCtrl:(0,_provider2.copyFormCtrl)(r)}},i=new CustomEvent(_provider.REACT_FORMCTRL.EVENTS.FORM_SUBMITED+"#"+e,o);document.dispatchEvent(i)}function forwardFieldChangedEvent(e,t,r){var n={detail:{form:e,field:t,fieldCtrl:(0,_provider2.copyFieldCtrl)(r)}},o=new CustomEvent(_provider.REACT_FORMCTRL.EVENTS.FIELD_CHANGED+"#"+e+"#"+t,n);document.dispatchEvent(o)}function forwardFormChangedEvent(e,t){var r={detail:{form:e,formCtrl:(0,_provider2.copyFormCtrl)(t)}},n=new CustomEvent(_provider.REACT_FORMCTRL.EVENTS.FORM_CHANGED+"#"+e,r);document.dispatchEvent(n)}function formProviderEffects(e,t){var r=t.type,n=t.payload,o=_provider.REACT_FORMCTRL.EVENTS,i=n.form,a=n.field,s=e.forms[i],l=a&&s?s.fields[a]:null;switch(r){case o.FIELD_BLURRED:case o.REGISTER_FIELD:case o.FIELD_CHANGED:case o.FIELD_PROPS_CHANGED:forwardFieldChangedEvent(i,a,l),forwardFormChangedEvent(i,s);break;case o.FORM_SUBMITED:forwardSubmitFormEvent(i,s.values,s,n.formRef);break;case o.FORM_RESETED:Object.keys(s.fields).forEach(function(e){var t=s.fields[e];forwardFieldChangedEvent(i,e,t)}),forwardFormChangedEvent(i,s);break;case o.REGISTER_FORM:case o.UNREGISTER_FORM:case o.UNREGISTER_FIELD:}}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function formProviderReducer(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{forms:{}},t=arguments[1],r=t.type,n=t.payload,o=_provider.REACT_FORMCTRL.EVENTS;switch(r){case o.REGISTER_FORM:return onRegisterForm(e,n.form);case o.UNREGISTER_FORM:return onUnregisterForm(e,n.form);case o.REGISTER_FIELD:return onRegisterField(e,n.form,n.field,n.fieldCtrl);case o.UNREGISTER_FIELD:return onUnregisterField(e,n.form,n.field);case o.FIELD_CHANGED:return onFieldChanged(e,n.form,n.field,n.value,n.files);case o.FIELD_PROPS_CHANGED:return onFieldPropsChanged(e,n.form,n.field,n.props);case o.FIELD_BLURRED:return onFieldBlurred(e,n.form,n.field);case o.FORM_SUBMITED:return onFormSubmited(e,n.form,n.formRef);case o.FORM_RESETED:return onFormReseted(e,n.form);default:return e}}function onRegisterForm(e,t){var r=_extends({},e.forms);return r[t]?r[t].__instances++:r[t]={__instances:1,formName:t,validating:!1,valid:!0,invalid:!1,untouched:!0,touched:!1,pristine:!0,dirty:!1,unchanged:!0,changed:!1,fields:{},values:{},files:{}},{forms:r}}function onRegisterField(e,t,r,n){if(e.forms[t]){var o=_extends({},e.forms),i=o[t];return i.fields[r]?n.__instances=i.fields[r].__instances+1:n.__instances=1,updateFieldCtrl(e,t,n,n.initialValue),i.fields[r]=n,i.values[r]=n.value,updateFormCtrl(t,i),{forms:o}}return console.warn('No form instance with name "'+t+'" to register field "'+r+'".'),e}function onUnregisterForm(e,t){if(e.forms[t]){var r=_extends({},e.forms),n=r[t];return n.__instances>1?n.__instances--:delete r[t],{forms:r}}return e}function onUnregisterField(e,t,r){if(e.forms[t]&&e.forms[t].fields[r]){var n=_extends({},e.forms),o=n[t],i=o.fields[r];return i.__instances>1?i.__instances--:delete o.fields[r],{forms:n}}return e}function onFieldChanged(e,t,r,n,o){if(e.forms[t]&&e.forms[t].fields[r]){var i=_extends({},e.forms),a=i[t],s=a.fields[r];return s.dirty=!0,s.pristine=!1,updateFieldCtrl(e,t,s,n,o),a.values||(a.values={}),a.values[r]=n,a.files||(a.files={}),o?a.files[r]=o:a.files[r]&&delete a.files[r],updateFormCtrl(t,a),{forms:i}}return e}function onFieldPropsChanged(e,t,r,n){var o=_extends({},e.forms),i=o[t],a=i.fields[r];return a.props=n,updateFieldCtrl(e,t,a,a.value),updateFormCtrl(t,i),{forms:o}}function onFieldBlurred(e,t,r){var n=_extends({},e.forms),o=n[t],i=o.fields[r];return i.touched=!0,i.untouched=!1,updateFormCtrl(t,o),{forms:n}}function onFormSubmited(e,t,r){return e}function onFormReseted(e,t){var r=_extends({},e.forms),n=r[t];return Object.keys(n.fields).forEach(function(r){var o=n.fields[r];updateFieldCtrl(e,t,o,o.initialValue),o.touched=!1,o.untouched=!0,o.dirty=!1,o.pristine=!0,n.values[r]=o.initialValue}),updateFormCtrl(t,n),{forms:r}}function updateFormCtrl(e,t){t.validating=!1,t.valid=!0,t.invalid=!1,t.untouched=!0,t.touched=!1,t.pristine=!0,t.dirty=!1,t.unchanged=!0,t.changed=!1,Object.keys(t.fields).forEach(function(e){var r=t.fields[e];r.validating&&(t.validating=!0),r.valid||(t.valid=!1),r.invalid&&(t.invalid=!0),r.untouched||(t.untouched=!1),r.touched&&(t.touched=!0),r.pristine||(t.pristine=!1),r.dirty&&(t.dirty=!0),r.unchanged||(t.unchanged=!1),r.changed&&(t.changed=!0)})}function updateFieldCtrl(e,t,r,n,o){var i=r.initialValue,a=r.props,s=(0,_validator.validate)(e.validators,e.forms[t],a,n,o)||[];r.value=n,r.errors=s,r.unchanged=n===i,r.changed=n!==i,r.valid=0===s.length,r.invalid=s.length>0}function copyFiles(e){if(e){if(Array.isArray(e))return copyArray(e);for(var t=[],r=0;r<e.length;r++){var n=e.item(r);t.push(n)}return t}return[]}function copyArray(e){return e?e.map(function(e){return e}):[]}function copyFieldCtrlProps(e){return{name:e.name,form:e.form,type:e.type,required:e.required,pattern:e.pattern,match:e.match,integer:e.integer,min:e.min,max:e.max,minLength:e.minLength,maxLength:e.maxLength,accept:e.accept,extensions:copyArray(e.extensions),maxSize:e.maxSize,validate:e.validate}}function copyError(e){var t={key:e.key};if(e.params){var r={};Object.keys(e.params).forEach(function(t){var n=e.params[t];Array.isArray(n)?r[t]=copyArray(n):n instanceof FileList?r[t]=copyFiles(n):r[t]=n}),t.params=r}else t.params=void 0;return t}function copyErrors(e){return e&&e.length?e.map(function(e){return copyError(e)}):e}function copyFieldCtrl(e){return{__instances:e.__instances,validating:e.validating,valid:e.valid,invalid:e.invalid,untouched:e.untouched,touched:e.touched,pristine:e.pristine,dirty:e.dirty,unchanged:e.unchanged,changed:e.changed,errors:copyErrors(e.errors),value:e.value,files:e.files,initialValue:e.initialValue,props:copyFieldCtrlProps(e.props)}}function copyFormValues(e){var t={};if(e){var r=Object.keys(e);r.length&&r.forEach(function(r){t[r]=e[r]})}return t}function copyFormFiles(e){var t={};if(e){var r=Object.keys(e);r.length&&r.forEach(function(r){t[r]=copyFiles(e[r])})}return t}function copyFormFields(e){var t={};if(e){var r=Object.keys(e);r.length&&r.forEach(function(r){t[r]=copyFieldCtrl(e[r])})}return t}function copyFormCtrl(e){return{__instances:e.__instances,formName:e.formName,validating:e.validating,valid:e.valid,invalid:e.invalid,untouched:e.untouched,touched:e.touched,pristine:e.pristine,dirty:e.dirty,unchanged:e.unchanged,changed:e.changed,fields:copyFormFields(e.fields),values:copyFormValues(e.values),files:copyFormFiles(e.files)}}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function getDefaultValidators(){var e=[];return e.push(new RequiredValidator),e.push(new PatternValidator),e.push(new EmailValidator),e.push(new IntegerValidator),e.push(new FloatValidator),e.push(new MinLengthValidator),e.push(new MaxLengthValidator),e.push(new MinValidator),e.push(new MaxValidator),e.push(new MatchValidator),e.push(new FileAcceptValidator),e.push(new FileExtensionValidator),e.push(new FileMaxSizeValidator),e}function combineValidators(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=getDefaultValidators(),r=e;return Array.isArray(r)||(r=[r]),r.forEach(function(e){return t.push(e)}),t}function validate(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1],r=arguments[2],n=arguments[3],o=arguments[4],i=e.filter(function(e){return e.shouldValidate(t,r,n,o)});if(i&&i.length){var a=[];return i.forEach(function(e){var i=e.validate(t,r,n,o);"boolean"==typeof i?i||a.push(e.createValidationError(n,o,{})):a.push(e.createValidationError(n,o,i))}),a}return null}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Field=void 0;var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_propTypes=require("prop-types"),_propTypes2=_interopRequireDefault(_propTypes),_provider=require("../provider/provider"),_provider2=require("../provider/provider.actions"),Field=exports.Field=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.state={valid:!0,invalid:!1,untouched:!0,touched:!1,pristine:!0,dirty:!1,unchanged:!0,changed:!1,errors:[],value:"",files:[],initialValue:e.initialValue||"",props:{name:e.name,form:e.form,type:e.type,required:e.required,pattern:e.pattern,match:e.match,integer:e.integer,min:e.min,max:e.max,minLength:e.minLength,maxLength:e.maxLength,accept:e.accept,extensions:e.extensions||[],maxSize:e.maxSize,validate:e.validate}},r.onChange=r.onChange.bind(r),r.handleFieldChangeForward=r.handleFieldChangeForward.bind(r),r.handleChange=r.handleChange.bind(r),r.handleBlur=r.handleBlur.bind(r),r.getChildProps=r.getChildProps.bind(r),r.inject=r.inject.bind(r),r}return _inherits(t,e),_createClass(t,[{key:"componentWillMount",value:function(){var e=this.props,t=e.form,r=e.name,n=e.children;if(Array.isArray(n)&&n.length>1)throw'The Field component for "'+t+"#"+r+'" should have only one child, but has '+n.length+".";document.addEventListener(_provider2.REACT_FORMCTRL.EVENTS.FIELD_CHANGED+"#"+t+"#"+r,this.handleFieldChangeForward),_provider.FormEventDispatcher.dispatchRegisterField(t,r,this.state)}},{key:"componentWillUnmount",value:function(){var e=this.props,t=e.form,r=e.name;document.removeEventListener(_provider2.REACT_FORMCTRL.EVENTS.FIELD_CHANGED+"#"+t+"#"+r,this.handleFieldChangeForward),_provider.FormEventDispatcher.dispatchUnregisterField(t,r)}},{key:"onChange",value:function(e){var t=this.props.onChange;"function"==typeof t&&t(e)}},{key:"handleFieldChangeForward",value:function(e){var t=e.detail.fieldCtrl;this.setState(t),this.onChange(t)}},{key:"handleChange",value:function(e){this.sync;var t=this.props,r=t.form,n=t.name,o=e.target,i=o.value,a=o.files;_provider.FormEventDispatcher.dispatchFieldChanged(r,n,i,a)}},{key:"handleBlur",value:function(e){if(this.state.untouched){var t=this.props,r=t.form,n=t.name;_provider.FormEventDispatcher.dispatchFieldBlur(r,n,_extends({},this.state,{touched:!0,untouched:!1}))}}},{key:"getChildProps",value:function(){var e={};return e.name=this.props.name,e.formName=this.props.form,e.ctrl={valid:this.state.valid,invalid:this.state.invalid,untouched:this.state.untouched,touched:this.state.touched,pristine:this.state.pristine,dirty:this.state.dirty,unchanged:this.state.unchanged,changed:this.state.changed,errors:this.state.errors},e.accept=this.props.accept,e.extensions=this.props.extensions,e.maxSize=this.props.maxSize,e.className=this.props.className,e.value=this.state.value,e.required=this.props.required,e.pattern=this.props.pattern,e.type=this.props.type||"text",e.onChange=this.handleChange,e.onBlur=this.handleBlur,e}},{key:"inject",value:function(){var e=this.props.inject,t=this.getChildProps();return"function"==typeof e?e(t):t}},{key:"render",value:function(){var e=this.inject,t=this.props.children,r=t;return Array.isArray(t)&&(r=t[0]),_react2.default.cloneElement(r,_extends({},r.props,e()))}}]),t}(_react2.default.Component);Field.propTypes={name:_propTypes2.default.string.isRequired,form:_propTypes2.default.string.isRequired,className:_propTypes2.default.string,required:_propTypes2.default.bool,pattern:_propTypes2.default.oneOfType([_propTypes2.default.string,_propTypes2.default.instanceOf(RegExp)]),type:_propTypes2.default.string,integer:_propTypes2.default.bool,inject:_propTypes2.default.func,match:_propTypes2.default.string,min:_propTypes2.default.oneOfType([_propTypes2.default.number,_propTypes2.default.string]),max:_propTypes2.default.oneOfType([_propTypes2.default.number,_propTypes2.default.string]),minLength:_propTypes2.default.oneOfType([_propTypes2.default.number,_propTypes2.default.string]),maxLength:_propTypes2.default.oneOfType([_propTypes2.default.number,_propTypes2.default.string]),accept:_propTypes2.default.string,extensions:_propTypes2.default.arrayOf(_propTypes2.default.string),maxSize:_propTypes2.default.oneOfType([_propTypes2.default.number,_propTypes2.default.string]),validate:_propTypes2.default.arrayOf(_propTypes2.default.oneOfType([_propTypes2.default.string,_propTypes2.default.shape({name:_propTypes2.default.string.isRequired,params:_propTypes2.default.any})]))},Object.defineProperty(exports,"__esModule",{value:!0}),exports.FormControl=exports.Form=void 0;var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_react2=_interopRequireDefault(_react=require("react")),_propTypes2=_interopRequireDefault(_propTypes=require("prop-types")),_provider=require("../provider/provider"),_provider2=require("../provider/provider.actions"),Form=exports.Form=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.state={ref:1e18*Math.random()+"-"+(new Date).getTime()},r.handleSubmit=r.handleSubmit.bind(r),r.handleReset=r.handleReset.bind(r),r.handleFormSubmitForward=r.handleFormSubmitForward.bind(r),r}return _inherits(t,e),_createClass(t,[{key:"handleSubmit",value:function(e){var t=this.props.name,r=this.state.ref;e.preventDefault(),_provider.FormEventDispatcher.dispatchSubmitForm(t,r)}},{key:"handleReset",value:function(e){var t=this.props.name;e.preventDefault(),_provider.FormEventDispatcher.dispatchResetForm(t)}},{key:"componentWillMount",value:function(){var e=this.props.name;document.addEventListener(_provider2.REACT_FORMCTRL.EVENTS.FORM_SUBMITED+"#"+e,this.handleFormSubmitForward),_provider.FormEventDispatcher.dispatchRegisterForm(e)}},{key:"handleFormSubmitForward",value:function(e){var t=this.props.onSubmit;if("function"==typeof t){var r=e.detail,n=r.values,o=r.formCtrl;r.formRef==this.state.ref&&t(n,o)}}},{key:"componentWillUnmount",value:function(){var e=this.props.name;document.removeEventListener(_provider2.REACT_FORMCTRL.EVENTS.FORM_SUBMITED+"#"+e,this.handleFormSubmitForward),_provider.FormEventDispatcher.dispatchUnregisterForm(e)}},{key:"render",value:function(){var e=this.handleSubmit,t=this.handleReset,r=this.props,n=r.name,o=r.children,i=r.className;return _react2.default.createElement("form",{id:n,name:n,className:i,onSubmit:e,onReset:t,noValidate:!0},o)}}]),t}(_react2.default.Component);Form.propTypes={name:_propTypes2.default.string.isRequired,className:_propTypes2.default.string,onSubmit:_propTypes2.default.func};var FormControl=exports.FormControl=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.state={valid:!0,invalid:!1,untouched:!0,touched:!1,pristine:!0,dirty:!1,unchanged:!0,changed:!1,fields:{},values:{},files:{}},r.onChange=r.onChange.bind(r),r.handleFormChanged=r.handleFormChanged.bind(r),r.inject=r.inject.bind(r),r.setFieldValue=r.setFieldValue.bind(r),r}return _inherits(t,e),_createClass(t,[{key:"componentWillMount",value:function(){var e=this.props,t=e.form,r=e.children;if(Array.isArray(r)&&r.length>1)throw'The FormControl component for "'+t+'" should have only one child, but has '+r.length+".";document.addEventListener(_provider2.REACT_FORMCTRL.EVENTS.FORM_CHANGED+"#"+t,this.handleFormChanged)}},{key:"componentWillUnmount",value:function(){var e=this.props.form;document.removeEventListener(_provider2.REACT_FORMCTRL.EVENTS.FORM_CHANGED+"#"+e,this.handleFormChanged)}},{key:"onChange",value:function(e){var t=this.props.onChange;"function"==typeof t&&t(e)}},{key:"handleFormChanged",value:function(e){var t=e.detail,r=(this.props.form,t.formCtrl);this.setState(r),this.onChange(r)}},{key:"setFieldValue",value:function(e,t){var r=this.props.form;_provider.FormEventDispatcher.dispatchFieldChanged(r,e,t)}},{key:"inject",value:function(){var e=this.props,t=e.inject,r=e.form,n=_extends({},this.state,{formName:r,setFieldValue:this.setFieldValue});return"function"==typeof t?t(n):{formCtrl:n}}},{key:"render",value:function(){var e=this.props.children,t=e;return Array.isArray(e)&&(t=e[0]),_react2.default.cloneElement(t,_extends({},t.props,this.inject()))}}]),t}(_react2.default.Component);FormControl.propTypes={form:_propTypes2.default.string.isRequired,onChange:_propTypes2.default.func,inject:_propTypes2.default.func},Object.defineProperty(exports,"__esModule",{value:!0});var _provider=require("./provider/provider");Object.defineProperty(exports,"REACT_FORMCTL",{enumerable:!0,get:function(){return _provider.REACT_FORMCTL}}),Object.defineProperty(exports,"FormEventDispatcher",{enumerable:!0,get:function(){return _provider.FormEventDispatcher}}),Object.defineProperty(exports,"FormProvider",{enumerable:!0,get:function(){return _provider.FormProvider}});var _form=require("./form/form");Object.defineProperty(exports,"Form",{enumerable:!0,get:function(){return _form.Form}}),Object.defineProperty(exports,"FormControl",{enumerable:!0,get:function(){return _form.FormControl}});var _field=require("./field/field");Object.defineProperty(exports,"Field",{enumerable:!0,get:function(){return _field.Field}}),Object.defineProperty(exports,"__esModule",{value:!0}),exports.REACT_FORMCTRL=exports.REACT_FORMCTRL_NAME=void 0,exports.onRegisterForm=onRegisterForm,exports.onUnregisterForm=onUnregisterForm,exports.onSubmitForm=onSubmitForm,exports.onResetForm=onResetForm,exports.onRegisterField=onRegisterField,exports.onUnregisterField=onUnregisterField,exports.onFieldPropsChanged=onFieldPropsChanged,exports.onFieldChanged=onFieldChanged,exports.onFieldBlur=onFieldBlur;var _provider=require("./provider"),_provider2=require("./provider.utils"),REACT_FORMCTRL_NAME=exports.REACT_FORMCTRL_NAME="react-formctl",REACT_FORMCTRL=exports.REACT_FORMCTRL={EVENTS:{REGISTER_FORM:REACT_FORMCTRL_NAME+".registerForm",UNREGISTER_FORM:REACT_FORMCTRL_NAME+".unregisterForm",REGISTER_FIELD:REACT_FORMCTRL_NAME+".registerField",UNREGISTER_FIELD:REACT_FORMCTRL_NAME+".unregisterField",FORM_CHANGED:REACT_FORMCTRL_NAME+".formChanged",FIELD_CHANGED:REACT_FORMCTRL_NAME+".fieldChanged",FIELD_PROPS_CHANGED:REACT_FORMCTRL_NAME+".fieldPropsChanged",FIELD_BLURRED:REACT_FORMCTRL_NAME+".fieldBlurred",FORM_SUBMITED:REACT_FORMCTRL_NAME+".formSubmited",FORM_RESETED:REACT_FORMCTRL_NAME+".formReseted"}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.formProviderEffects=formProviderEffects;var _provider=require("./provider.actions"),_provider2=require("./provider.utils");Object.defineProperty(exports,"__esModule",{value:!0}),exports.FormProvider=exports.FormEventDispatcher=void 0;var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_react2=_interopRequireDefault(_react=require("react")),_propTypes2=_interopRequireDefault(_propTypes=require("prop-types")),_provider=require("./provider.actions"),_validator=require("../validator/validator"),_provider2=require("./provider.utils"),_provider3=require("./provider.reducer"),_provider4=require("./provider.effects"),PROVIDER_EVENT=_provider.REACT_FORMCTRL_NAME+".FormProvider",FormEventDispatcher=exports.FormEventDispatcher=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"dispatchRegisterForm",value:function(e){var t={detail:(0,_provider.onRegisterForm)(e)},r=new CustomEvent(PROVIDER_EVENT,t);document.dispatchEvent(r)}},{key:"dispatchUnregisterForm",value:function(e){var t={detail:(0,_provider.onUnregisterForm)(e)},r=new CustomEvent(PROVIDER_EVENT,t);document.dispatchEvent(r)}},{key:"dispatchSubmitForm",value:function(e,t){var r={detail:(0,_provider.onSubmitForm)(e,t)},n=new CustomEvent(PROVIDER_EVENT,r);document.dispatchEvent(n)}},{key:"dispatchResetForm",value:function(e){var t={detail:(0,_provider.onResetForm)(e)},r=new CustomEvent(PROVIDER_EVENT,t);document.dispatchEvent(r)}},{key:"dispatchRegisterField",value:function(e,t,r){var n={detail:(0,_provider.onRegisterField)(e,t,r)},o=new CustomEvent(PROVIDER_EVENT,n);document.dispatchEvent(o)}},{key:"dispatchUnregisterField",value:function(e,t){var r={detail:(0,_provider.onUnregisterField)(e,t)},n=new CustomEvent(PROVIDER_EVENT,r);document.dispatchEvent(n)}},{key:"dispatchFieldPropsChanged",value:function(e,t,r){var n={detail:(0,_provider.onFieldPropsChanged)(e,t,r)},o=new CustomEvent(PROVIDER_EVENT,n);document.dispatchEvent(o)}},{key:"dispatchFieldChanged",value:function(e,t,r,n){var o={detail:(0,_provider.onFieldChanged)(e,t,r,n)},i=new CustomEvent(PROVIDER_EVENT,o);document.dispatchEvent(i)}},{key:"dispatchFieldBlur",value:function(e,t){var r={detail:(0,_provider.onFieldBlur)(e,t)},n=new CustomEvent(PROVIDER_EVENT,r);document.dispatchEvent(n)}}]),e}(),FormProvider=exports.FormProvider=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.state={forms:{},validators:{}},r.onEvent=r.onEvent.bind(r),r}return _inherits(t,e),_createClass(t,[{key:"componentWillMount",value:function(){document.addEventListener(PROVIDER_EVENT,this.onEvent);var e=this.props.validators,t=void 0===e?[]:e,r={validators:(0,_validator.combineValidators)(t)};this.setState(r)}},{key:"componentWillUnmount",value:function(){document.removeEventListener(PROVIDER_EVENT,this.onEvent)}},{key:"onEvent",value:function(e){var t=e.detail;this.setState(function(e){var r=(0,_provider3.formProviderReducer)(e,t);return(0,_provider4.formProviderEffects)(r,t),r})}},{key:"render",value:function(){return this.props.children}}]),t}(_react2.default.Component);FormProvider.propTypes={customValidators:_propTypes2.default.arrayOf(_propTypes2.default.shape({name:_propTypes2.default.string.isRequired,validate:_propTypes2.default.func.isRequired}))},Object.defineProperty(exports,"__esModule",{value:!0});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};exports.formProviderReducer=formProviderReducer;var _provider=require("./provider.actions"),_validator=require("../validator/validator"),INTEGER_REGEX=/^-?\d+?$/,FLOAT_REGEX=/^-?\d+(\.\d+)?$/,EMAIL_REGEX=/\S+@\S+\.\S+/;Object.defineProperty(exports,"__esModule",{value:!0}),exports.copyFiles=copyFiles,exports.copyArray=copyArray,exports.copyFieldCtrlProps=copyFieldCtrlProps,exports.copyError=copyError,exports.copyErrors=copyErrors,exports.copyFieldCtrl=copyFieldCtrl,exports.copyFormValues=copyFormValues,exports.copyFormFiles=copyFormFiles,exports.copyFormFields=copyFormFields,exports.copyFormCtrl=copyFormCtrl,Object.defineProperty(exports,"__esModule",{value:!0});var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();exports.getDefaultValidators=getDefaultValidators,exports.combineValidators=combineValidators,exports.validate=validate;var INTEGER_REGEX=/^-?\d+?$/,FLOAT_REGEX=/^-?\d+(\.\d+)?$/,EMAIL_REGEX=/\S+@\S+\.\S+/,Validator=exports.Validator=function(){function e(t){_classCallCheck(this,e),this.name=t}return _createClass(e,[{key:"shouldValidate",value:function(e,t,r,n){return!0}},{key:"validate",value:function(e,t,r,n){return!0}},{key:"createValidationError",value:function(e,t,r){var n={key:this.name};return(Object.keys(r).length||e||t&&t.length)&&(n.params=_extends({},r),e&&(n.params.value=e),t&&t.length&&(n.params.files=t)),n}}]),e}(),RequiredValidator=exports.RequiredValidator=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"required"))}return _inherits(t,Validator),_createClass(t,[{key:"shouldValidate",value:function(e,t,r,n){return!!t.required}},{key:"validate",value:function(e,t,r,n){return"file"===t.type?!!n&&!!n.length:!!r}}]),t}(),PatternValidator=exports.PatternValidator=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"pattern"))}return _inherits(t,Validator),_createClass(t,[{key:"shouldValidate",value:function(e,t,r,n){return!!r&&!!t.pattern}},{key:"getRegExp",value:function(e){return e.pattern instanceof RegExp?e.pattern:new RegExp(e.pattern)}},{key:"validate",value:function(e,t,r,n){var o=this.getRegExp(t);return!!o.test(r)||{pattern:o}}}]),t}(),EmailValidator=exports.EmailValidator=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"email"))}return _inherits(t,Validator),_createClass(t,[{key:"shouldValidate",value:function(e,t,r,n){return!!r&&"email"===t.type}},{key:"validate",value:function(e,t,r,n){return EMAIL_REGEX.test(r)}}]),t}(),IntegerValidator=exports.IntegerValidator=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"integer"))}return _inherits(t,Validator),_createClass(t,[{key:"shouldValidate",value:function(e,t,r,n){return!!r&&"number"===t.type&&t.integer}},{key:"validate",value:function(e,t,r,n){return INTEGER_REGEX.test(r)}}]),t}(),FloatValidator=exports.FloatValidator=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"float"))}return _inherits(t,Validator),_createClass(t,[{key:"shouldValidate",value:function(e,t,r,n){return!!r&&"number"===t.type&&!t.integer}},{key:"validate",value:function(e,t,r,n){return FLOAT_REGEX.test(r)}}]),t}(),MinLengthValidator=exports.MinLengthValidator=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"minLength"))}return _inherits(t,Validator),_createClass(t,[{key:"shouldValidate",value:function(e,t,r,n){return!!r&&void 0!==t.minLength&&null!==t.minLength}},{key:"validate",value:function(e,t,r,n){return!((r+"").length<+t.minLength)||{length:(r+"").length,minLength:+t.minLength}}}]),t}(),MaxLengthValidator=exports.MaxLengthValidator=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"maxLength"))}return _inherits(t,Validator),_createClass(t,[{key:"shouldValidate",value:function(e,t,r,n){return!!r&&void 0!==t.maxLength&&null!==t.maxLength}},{key:"validate",value:function(e,t,r,n){return!((r+"").length>+t.maxLength)||{length:(r+"").length,maxLength:t.maxLength}}}]),t}(),MinValidator=exports.MinValidator=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"min"))}return _inherits(t,Validator),_createClass(t,[{key:"shouldValidate",value:function(e,t,r,n){return!!r&&"number"===t.type&&void 0!==t.min&&null!==t.min}},{key:"validate",value:function(e,t,r,n){return!(+r<+t.min)||{min:+t.min}}}]),t}(),MaxValidator=exports.MaxValidator=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"max"))}return _inherits(t,Validator),_createClass(t,[{key:"shouldValidate",value:function(e,t,r,n){return!!r&&"number"===t.type&&void 0!==t.max&&null!==t.max}},{key:"validate",value:function(e,t,r,n){return!(+r>+t.max)||{max:+t.max}}}]),t}(),MatchValidator=exports.MatchValidator=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"match"))}return _inherits(t,Validator),_createClass(t,[{key:"shouldValidate",value:function(e,t,r,n){return!!r&&!!t.match&&e&&e.values&&e.fields[t.match]}},{key:"validate",value:function(e,t,r,n){return r===e.values[t.match]||{match:t.match}}}]),t}(),FileAcceptValidator=exports.FileAcceptValidator=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"accept"))}return _inherits(t,Validator),_createClass(t,[{key:"shouldValidate",value:function(e,t,r,n){return"file"===t.type&&!!t.accept&&n&&n.length}},{key:"validate",value:function(e,t,r,n){var o=n.filter(function(e){return 0===t.accept.replace(/ /g,"").split(",").filter(function(t){return new RegExp("^"+t.replace(/\*/g,".*")+"$").test(e.type)}).length});return!(o.length>0)||{files:o,accept:t.accept}}}]),t}(),FileExtensionValidator=exports.FileExtensionValidator=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"extensions"))}return _inherits(t,Validator),_createClass(t,[{key:"shouldValidate",value:function(e,t,r,n){return"file"===t.type&&t.extensions&&t.extensions.length&&n&&n.length}},{key:"validate",value:function(e,t,r,n){var o=n.filter(function(e){return 0===t.extensions.filter(function(t){return new RegExp("\\."+t.replace(/\./,"")+"$","i").test(e.name)}).length});return!(o.length>0)||{files:o,extensions:t.extensions}}}]),t}(),FileMaxSizeValidator=exports.FileMaxSizeValidator=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"maxSize"))}return _inherits(t,Validator),_createClass(t,[{key:"shouldValidate",value:function(e,t,r,n){return"file"===t.type&&+t.maxSize>0&&n&&n.length}},{key:"validate",value:function(e,t,r,n){var o=n.filter(function(e){return e.size>+t.maxSize});return!(o.length>0)||{files:o,maxSize:+t.maxSize}}}]),t}();