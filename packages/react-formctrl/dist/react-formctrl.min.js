"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Field=void 0;var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_propTypes=require("prop-types"),_propTypes2=_interopRequireDefault(_propTypes),_provider=require("../provider/provider"),Field=exports.Field=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.state={valid:!0,invalid:!1,untouched:!0,touched:!1,pristine:!0,dirty:!1,unchanged:!0,changed:!1,errors:[],value:"",files:[],initialValue:e.initialValue||"",props:{name:e.name,form:e.form,type:e.type,required:e.required,pattern:e.pattern,match:e.match,integer:e.integer,min:e.min,max:e.max,minLength:e.minLength,maxLength:e.maxLength,accept:e.accept,extensions:e.extensions||[],maxSize:e.maxSize,validate:e.validate}},r.onChange=r.onChange.bind(r),r.handleFieldChangeForward=r.handleFieldChangeForward.bind(r),r.handleChange=r.handleChange.bind(r),r.handleBlur=r.handleBlur.bind(r),r.getChildProps=r.getChildProps.bind(r),r.inject=r.inject.bind(r),r}return _inherits(t,e),_createClass(t,[{key:"componentWillMount",value:function(){var e=this.props,t=e.form,r=e.name,n=e.children;if(Array.isArray(n)&&n.length>1)throw'The Field component for "'+t+"#"+r+'" should have only one child, but has '+n.length+".";document.addEventListener(_provider.REACT_FORMCTRL.EVENTS.FIELD_CHANGED+"#"+t+"#"+r,this.handleFieldChangeForward),_provider.FormEventDispatcher.dispatchRegisterField(t,r,this.state)}},{key:"componentWillUnmount",value:function(){var e=this.props,t=e.form,r=e.name;document.removeEventListener(_provider.REACT_FORMCTRL.EVENTS.FIELD_CHANGED+"#"+t+"#"+r,this.handleFieldChangeForward),_provider.FormEventDispatcher.dispatchUnregisterField(t,r)}},{key:"onChange",value:function(e){var t=this.props.onChange;"function"==typeof t&&t(e)}},{key:"handleFieldChangeForward",value:function(e){var t=e.detail.fieldCtrl;this.setState(t),this.onChange(t)}},{key:"handleChange",value:function(e){this.sync;var t=this.props,r=t.form,n=t.name,i=e.target,o=i.value,a=i.files;_provider.FormEventDispatcher.dispatchFieldChanged(r,n,o,a)}},{key:"handleBlur",value:function(e){if(this.state.untouched){var t=this.props,r=t.form,n=t.name;_provider.FormEventDispatcher.dispatchFieldBlur(r,n,_extends({},this.state,{touched:!0,untouched:!1}))}}},{key:"getChildProps",value:function(){var e={};return e.name=this.props.name,e.formName=this.props.form,e.ctrl={valid:this.state.valid,invalid:this.state.invalid,untouched:this.state.untouched,touched:this.state.touched,pristine:this.state.pristine,dirty:this.state.dirty,unchanged:this.state.unchanged,changed:this.state.changed,errors:this.state.errors},e.accept=this.props.accept,e.extensions=this.props.extensions,e.maxSize=this.props.maxSize,e.className=this.props.className,e.value=this.state.value,e.required=this.props.required,e.pattern=this.props.pattern,e.type=this.props.type||"text",e.onChange=this.handleChange,e.onBlur=this.handleBlur,e}},{key:"inject",value:function(){var e=this.props.inject,t=this.getChildProps();return"function"==typeof e?e(t):t}},{key:"render",value:function(){var e=this.inject,t=this.props.children,r=t;return Array.isArray(t)&&(r=t[0]),_react2.default.cloneElement(r,_extends({},r.props,e()))}}]),t}(_react2.default.Component);Field.propTypes={name:_propTypes2.default.string.isRequired,form:_propTypes2.default.string.isRequired,className:_propTypes2.default.string,required:_propTypes2.default.bool,pattern:_propTypes2.default.oneOfType([_propTypes2.default.string,_propTypes2.default.instanceOf(RegExp)]),type:_propTypes2.default.string,integer:_propTypes2.default.bool,inject:_propTypes2.default.func,match:_propTypes2.default.string,min:_propTypes2.default.oneOfType([_propTypes2.default.number,_propTypes2.default.string]),max:_propTypes2.default.oneOfType([_propTypes2.default.number,_propTypes2.default.string]),minLength:_propTypes2.default.oneOfType([_propTypes2.default.number,_propTypes2.default.string]),maxLength:_propTypes2.default.oneOfType([_propTypes2.default.number,_propTypes2.default.string]),accept:_propTypes2.default.string,extensions:_propTypes2.default.arrayOf(_propTypes2.default.string),maxSize:_propTypes2.default.oneOfType([_propTypes2.default.number,_propTypes2.default.string]),validate:_propTypes2.default.arrayOf(_propTypes2.default.oneOfType([_propTypes2.default.string,_propTypes2.default.shape({name:_propTypes2.default.string.isRequired,params:_propTypes2.default.any})]))},Object.defineProperty(exports,"__esModule",{value:!0}),exports.FormControl=exports.Form=void 0;var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_react2=_interopRequireDefault(_react=require("react")),_propTypes2=_interopRequireDefault(_propTypes=require("prop-types")),_provider=require("../provider/provider"),Form=exports.Form=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.state={ref:1e18*Math.random()+"-"+(new Date).getTime()},r.handleSubmit=r.handleSubmit.bind(r),r.handleReset=r.handleReset.bind(r),r.handleFormSubmitForward=r.handleFormSubmitForward.bind(r),r}return _inherits(t,e),_createClass(t,[{key:"handleSubmit",value:function(e){var t=this.props.name,r=this.state.ref;e.preventDefault(),_provider.FormEventDispatcher.dispatchSubmitForm(t,r)}},{key:"handleReset",value:function(e){var t=this.props.name;e.preventDefault(),_provider.FormEventDispatcher.dispatchResetForm(t)}},{key:"componentWillMount",value:function(){var e=this.props.name;document.addEventListener(_provider.REACT_FORMCTRL.EVENTS.FORM_SUBMITED+"#"+e,this.handleFormSubmitForward),_provider.FormEventDispatcher.dispatchRegisterForm(e)}},{key:"handleFormSubmitForward",value:function(e){var t=this.props.onSubmit;if("function"==typeof t){var r=e.detail,n=r.values,i=r.formCtrl;r.formRef==this.state.ref&&t(n,i)}}},{key:"componentWillUnmount",value:function(){var e=this.props.name;document.removeEventListener(_provider.REACT_FORMCTRL.EVENTS.FORM_SUBMITED+"#"+e,this.handleFormSubmitForward),_provider.FormEventDispatcher.dispatchUnregisterForm(e)}},{key:"render",value:function(){var e=this.handleSubmit,t=this.handleReset,r=this.props,n=r.name,i=r.children,o=r.className;return _react2.default.createElement("form",{id:n,name:n,className:o,onSubmit:e,onReset:t,noValidate:!0},i)}}]),t}(_react2.default.Component);Form.propTypes={name:_propTypes2.default.string.isRequired,className:_propTypes2.default.string,onSubmit:_propTypes2.default.func};var FormControl=exports.FormControl=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.state={valid:!0,invalid:!1,untouched:!0,touched:!1,pristine:!0,dirty:!1,unchanged:!0,changed:!1,fields:{},values:{},files:{}},r.onChange=r.onChange.bind(r),r.handleFormChanged=r.handleFormChanged.bind(r),r.inject=r.inject.bind(r),r.setFieldValue=r.setFieldValue.bind(r),r}return _inherits(t,e),_createClass(t,[{key:"componentWillMount",value:function(){var e=this.props,t=e.form,r=e.children;if(Array.isArray(r)&&r.length>1)throw'The FormControl component for "'+t+'" should have only one child, but has '+r.length+".";document.addEventListener(_provider.REACT_FORMCTRL.EVENTS.FORM_CHANGED+"#"+t,this.handleFormChanged)}},{key:"componentWillUnmount",value:function(){var e=this.props.form;document.removeEventListener(_provider.REACT_FORMCTRL.EVENTS.FORM_CHANGED+"#"+e,this.handleFormChanged)}},{key:"onChange",value:function(e){var t=this.props.onChange;"function"==typeof t&&t(e)}},{key:"handleFormChanged",value:function(e){var t=e.detail,r=(this.props.form,t.formCtrl);this.setState(r),this.onChange(r)}},{key:"setFieldValue",value:function(e,t){var r=this.props.form;_provider.FormEventDispatcher.dispatchFieldChanged(r,e,t)}},{key:"inject",value:function(){var e=this.props,t=e.inject,r=e.form,n=_extends({},this.state,{formName:r,setFieldValue:this.setFieldValue});return"function"==typeof t?t(n):{formCtrl:n}}},{key:"render",value:function(){var e=this.props.children,t=e;return Array.isArray(e)&&(t=e[0]),_react2.default.cloneElement(t,_extends({},t.props,this.inject()))}}]),t}(_react2.default.Component);FormControl.propTypes={form:_propTypes2.default.string.isRequired,onChange:_propTypes2.default.func,inject:_propTypes2.default.func},Object.defineProperty(exports,"__esModule",{value:!0});var _provider=require("./provider/provider");Object.defineProperty(exports,"REACT_FORMCTL",{enumerable:!0,get:function(){return _provider.REACT_FORMCTL}}),Object.defineProperty(exports,"FormEventDispatcher",{enumerable:!0,get:function(){return _provider.FormEventDispatcher}}),Object.defineProperty(exports,"FormProvider",{enumerable:!0,get:function(){return _provider.FormProvider}});var _form=require("./form/form");Object.defineProperty(exports,"Form",{enumerable:!0,get:function(){return _form.Form}}),Object.defineProperty(exports,"FormControl",{enumerable:!0,get:function(){return _form.FormControl}});var _field=require("./field/field");Object.defineProperty(exports,"Field",{enumerable:!0,get:function(){return _field.Field}}),Object.defineProperty(exports,"__esModule",{value:!0}),exports.FormProvider=exports.FormEventDispatcher=exports.REACT_FORMCTRL=void 0;var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_react2=_interopRequireDefault(_react=require("react")),_propTypes2=_interopRequireDefault(_propTypes=require("prop-types")),REACT_FORMCTRL_NAME="react-formctl",INTEGER_REGEX=/^-?\d+?$/,FLOAT_REGEX=/^-?\d+(\.\d+)?$/,EMAIL_REGEX=/\S+@\S+\.\S+/,PROVIDER_FLAG=REACT_FORMCTRL_NAME+".FormProvider",REACT_FORMCTRL=exports.REACT_FORMCTRL={EVENTS:{REGISTER_FORM:REACT_FORMCTRL_NAME+".registerForm",UNREGISTER_FORM:REACT_FORMCTRL_NAME+".unregisterForm",REGISTER_FIELD:REACT_FORMCTRL_NAME+".registerField",UNREGISTER_FIELD:REACT_FORMCTRL_NAME+".unregisterField",FORM_CHANGED:REACT_FORMCTRL_NAME+".formChanged",FIELD_CHANGED:REACT_FORMCTRL_NAME+".fieldChanged",FIELD_PROPS_CHANGED:REACT_FORMCTRL_NAME+".fieldPropsChanged",FIELD_BLURRED:REACT_FORMCTRL_NAME+".fieldBlurred",FORM_SUBMITED:REACT_FORMCTRL_NAME+".formSubmited",FORM_RESETED:REACT_FORMCTRL_NAME+".formReseted"}},FormEventDispatcher=exports.FormEventDispatcher=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"copyFiles",value:function(t){if(t){if(Array.isArray(t))return e.copyArray(t);for(var r=[],n=0;n<t.length;n++){var i=t.item(n);r.push(i)}return r}return[]}},{key:"copyArray",value:function(e){return e?e.map(function(e){return e}):[]}},{key:"copyFieldCtrlProps",value:function(t){return{name:t.name,form:t.form,type:t.type,required:t.required,pattern:t.pattern,match:t.match,integer:t.integer,min:t.min,max:t.max,minLength:t.minLength,maxLength:t.maxLength,accept:t.accept,extensions:e.copyArray(t.extensions),maxSize:t.maxSize,validate:t.validate}}},{key:"copyError",value:function(t){var r={key:t.key};if(t.params){var n={};Object.keys(t.params).forEach(function(r){var i=t.params[r];Array.isArray(i)?n[r]=e.copyArray(i):i instanceof FileList?n[r]=e.copyFiles(i):n[r]=i}),r.params=n}return r}},{key:"copyErrors",value:function(t){return t&&t.length?t.map(function(t){return e.copyError(t)}):t}},{key:"copyFieldCtrl",value:function(t){return{valid:t.valid,invalid:t.invalid,untouched:t.untouched,touched:t.touched,pristine:t.pristine,dirty:t.dirty,unchanged:t.unchanged,changed:t.changed,errors:e.copyErrors(t.errors),value:t.value,files:t.files,initialValue:t.initialValue,props:e.copyFieldCtrlProps(t.props)}}},{key:"copyFormValues",value:function(e){var t={};if(e){var r=Object.keys(e);r.length&&r.forEach(function(r){t[r]=e[r]})}return t}},{key:"copyFormFiles",value:function(t){var r={};if(t){var n=Object.keys(t);n.length&&n.forEach(function(n){r[n]=e.copyFiles(t[n])})}return r}},{key:"copyFormFields",value:function(t){var r={};if(t){var n=Object.keys(t);n.length&&n.forEach(function(n){r[n]=e.copyFieldCtrl(t[n])})}return r}},{key:"copyFormCtrl",value:function(t){return{valid:t.valid,invalid:t.invalid,untouched:t.untouched,touched:t.touched,pristine:t.pristine,dirty:t.dirty,unchanged:t.unchanged,changed:t.changed,fields:e.copyFormFields(t.fields),values:e.copyFormValues(t.values),files:e.copyFormFiles(t.files)}}},{key:"dispatchRegisterForm",value:function(e){var t={detail:{form:e}},r=new CustomEvent(REACT_FORMCTRL.EVENTS.REGISTER_FORM,t);document.dispatchEvent(r)}},{key:"dispatchUnregisterForm",value:function(e){var t={detail:{form:e}},r=new CustomEvent(REACT_FORMCTRL.EVENTS.UNREGISTER_FORM,t);document.dispatchEvent(r)}},{key:"dispatchSubmitForm",value:function(e,t){var r={detail:{form:e,formRef:t}},n=new CustomEvent(REACT_FORMCTRL.EVENTS.FORM_SUBMITED,r);document.dispatchEvent(n)}},{key:"dispatchResetForm",value:function(e){var t={detail:{form:e}},r=new CustomEvent(REACT_FORMCTRL.EVENTS.FORM_RESETED,t);document.dispatchEvent(r)}},{key:"dispatchRegisterField",value:function(t,r,n){var i={detail:{form:t,field:r,fieldCtrl:e.copyFieldCtrl(n)}},o=new CustomEvent(REACT_FORMCTRL.EVENTS.REGISTER_FIELD,i);document.dispatchEvent(o)}},{key:"dispatchUnregisterField",value:function(e,t){var r={detail:{form:e,field:t}},n=new CustomEvent(REACT_FORMCTRL.EVENTS.UNREGISTER_FIELD,r);document.dispatchEvent(n)}},{key:"dispatchFieldPropsChanged",value:function(t,r,n){var i={detail:{form:t,field:r,props:e.copyFieldCtrlProps(n)}},o=new CustomEvent(REACT_FORMCTRL.EVENTS.FIELD_PROPS_CHANGED,i);document.dispatchEvent(o)}},{key:"dispatchFieldChanged",value:function(t,r,n,i){var o={detail:{form:t,field:r,value:n,files:e.copyFiles(i)}},a=new CustomEvent(REACT_FORMCTRL.EVENTS.FIELD_CHANGED,o);document.dispatchEvent(a)}},{key:"dispatchFieldBlur",value:function(e,t){var r={detail:{form:e,field:t}},n=new CustomEvent(REACT_FORMCTRL.EVENTS.FIELD_BLURRED,r);document.dispatchEvent(n)}},{key:"forwardSubmitFormEvent",value:function(t,r,n,i){var o={detail:{values:r,formRef:i,formCtrl:e.copyFormCtrl(n)}},a=new CustomEvent(REACT_FORMCTRL.EVENTS.FORM_SUBMITED+"#"+t,o);document.dispatchEvent(a)}},{key:"forwardFieldChangedEvent",value:function(t,r,n){var i={detail:{form:t,field:r,fieldCtrl:e.copyFieldCtrl(n)}},o=new CustomEvent(REACT_FORMCTRL.EVENTS.FIELD_CHANGED+"#"+t+"#"+r,i);document.dispatchEvent(o)}},{key:"forwardFormChangedEvent",value:function(t,r){var n={detail:{form:t,formCtrl:e.copyFormCtrl(r)}},i=new CustomEvent(REACT_FORMCTRL.EVENTS.FORM_CHANGED+"#"+t,n);document.dispatchEvent(i)}}]),e}(),FormProvider=exports.FormProvider=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.state={forms:{},customValidators:{}},r.subscribe=r.subscribe.bind(r),r.unsubscribe=r.unsubscribe.bind(r),r.onEvent=r.onEvent.bind(r),r.onRegisterForm=r.onRegisterForm.bind(r),r.onUnregisterForm=r.onUnregisterForm.bind(r),r.onRegisterField=r.onRegisterField.bind(r),r.onUnregisterField=r.onUnregisterField.bind(r),r.onFieldChanged=r.onFieldChanged.bind(r),r.onFieldPropsChanged=r.onFieldPropsChanged.bind(r),r.onFieldBlurred=r.onFieldBlurred.bind(r),r.onFormSubmited=r.onFormSubmited.bind(r),r.onFormReseted=r.onFormReseted.bind(r),r.updateFormCtrl=r.updateFormCtrl.bind(r),r.updateFieldCtrl=r.updateFieldCtrl.bind(r),r}return _inherits(t,e),_createClass(t,[{key:"componentWillMount",value:function(){this.subscribe();var e={customValidators:{}},t=this.props.customValidators;(void 0===t?[]:t).forEach(function(t){e.customValidators[t.name]=t.validate}),this.setState(e)}},{key:"componentWillUnmount",value:function(){this.unsubscribe()}},{key:"subscribe",value:function(){document.addEventListener(REACT_FORMCTRL.EVENTS.REGISTER_FORM,this.onEvent),document.addEventListener(REACT_FORMCTRL.EVENTS.REGISTER_FIELD,this.onEvent),document.addEventListener(REACT_FORMCTRL.EVENTS.UNREGISTER_FORM,this.onEvent),document.addEventListener(REACT_FORMCTRL.EVENTS.UNREGISTER_FIELD,this.onEvent),document.addEventListener(REACT_FORMCTRL.EVENTS.FIELD_CHANGED,this.onEvent),document.addEventListener(REACT_FORMCTRL.EVENTS.FIELD_BLURRED,this.onEvent),document.addEventListener(REACT_FORMCTRL.EVENTS.FIELD_PROPS_CHANGED,this.onEvent),document.addEventListener(REACT_FORMCTRL.EVENTS.FORM_SUBMITED,this.onEvent),document.addEventListener(REACT_FORMCTRL.EVENTS.FORM_RESETED,this.onEvent)}},{key:"onEvent",value:function(e){var t=e.type,r=e.detail,n=REACT_FORMCTRL.EVENTS;switch(t){case n.REGISTER_FORM:this.onRegisterForm(r.form);break;case n.UNREGISTER_FORM:this.onUnregisterForm(r.form);break;case n.REGISTER_FIELD:this.onRegisterField(r.form,r.field,r.fieldCtrl);break;case n.UNREGISTER_FIELD:this.onUnregisterField(r.form,r.field);break;case n.FIELD_CHANGED:this.onFieldChanged(r.form,r.field,r.value,r.files);break;case n.FIELD_PROPS_CHANGED:this.onFieldPropsChanged(r.form,r.field,r.props);break;case n.FIELD_BLURRED:this.onFieldBlurred(r.form,r.field);break;case n.FORM_SUBMITED:this.onFormSubmited(r.form,r.formRef);break;case n.FORM_RESETED:this.onFormReseted(r.form)}}},{key:"onRegisterForm",value:function(e){this.setState(function(t){var r=_extends({},t.forms);return r[e]?r[e].__instances++:r[e]={__instances:1,formName:e,validating:!1,valid:!0,invalid:!1,untouched:!0,touched:!1,pristine:!0,dirty:!1,unchanged:!0,changed:!1,fields:{},values:{},files:{}},{forms:r}})}},{key:"onRegisterField",value:function(e,t,r){var n=this;this.setState(function(i){if(i.forms[e]){var o=_extends({},i.forms),a=o[e];return a.fields[t]?r.__instances=a.fields[t].__instances+1:r.__instances=1,n.updateFieldCtrl(e,r,r.initialValue),FormEventDispatcher.forwardFieldChangedEvent(e,t,r),a.fields[t]=r,a.values[t]=r.value,n.updateFormCtrl(e,a),{forms:o}}return console.warn('No form instance with name "'+e+'" to register field "'+t+'".'),i})}},{key:"onUnregisterForm",value:function(e){this.setState(function(t){if(t.forms[e]){var r=_extends({},t.forms),n=r[e];return n.__instances>1?n.__instances--:delete r[e],{forms:r}}return t})}},{key:"onUnregisterField",value:function(e,t){this.setState(function(r){if(r.forms[e]&&r.forms[e].fields[t]){var n=_extends({},r.forms),i=n[e],o=i.fields[t];return o.__instances>1?o.__instances--:delete i.fields[t],{forms:n}}return r})}},{key:"onFieldChanged",value:function(e,t,r,n){var i=this;this.setState(function(o){if(o.forms[e]&&o.forms[e].fields[t]){var a=_extends({},o.forms),s=a[e],l=s.fields[t];return l.dirty=!0,l.pristine=!1,i.updateFieldCtrl(e,l,r,n),FormEventDispatcher.forwardFieldChangedEvent(e,t,l),s.values||(s.values={}),s.values[t]=r,s.files||(s.files={}),n?s.files[t]=n:s.files[t]&&delete s.files[t],i.updateFormCtrl(e,s),{forms:a}}return o})}},{key:"onFieldPropsChanged",value:function(e,t,r){var n=this;this.setState(function(i){var o=_extends({},i.forms),a=o[e],s=a.fields[t];return s.props=r,n.updateFieldCtrl(e,s,s.value),FormEventDispatcher.forwardFieldChangedEvent(e,t,s),n.updateFormCtrl(e,a),{forms:o}})}},{key:"onFieldBlurred",value:function(e,t){var r=this;this.setState(function(n){var i=_extends({},n.forms),o=i[e],a=o.fields[t];return a.touched=!0,a.untouched=!1,FormEventDispatcher.forwardFieldChangedEvent(e,t,a),r.updateFormCtrl(e,o),{forms:i}})}},{key:"updateFormCtrl",value:function(e,t){t.validating=!1,t.valid=!0,t.invalid=!1,t.untouched=!0,t.touched=!1,t.pristine=!0,t.dirty=!1,t.unchanged=!0,t.changed=!1,Object.keys(t.fields).forEach(function(e){var r=t.fields[e];r.validating&&(t.validating=!0),r.valid||(t.valid=!1),r.invalid&&(t.invalid=!0),r.untouched||(t.untouched=!1),r.touched&&(t.touched=!0),r.pristine||(t.pristine=!1),r.dirty&&(t.dirty=!0),r.unchanged||(t.unchanged=!1),r.changed&&(t.changed=!0)}),FormEventDispatcher.forwardFormChangedEvent(e,t)}},{key:"createValidationError",value:function(e,t){return{key:e,params:t}}},{key:"updateFieldCtrl",value:function(e,t,r,n){var i=this,o=[],a=this.state.customValidators,s=void 0===a?{}:a,l=t.initialValue,u=t.props,d=(u.name,u.type),p=void 0===d?"text":d,c=u.required,f=void 0===c?null:c,h=u.pattern,E=void 0===h?null:h,m=u.match,v=void 0===m?null:m,_=u.integer,R=void 0===_?null:_,F=u.min,y=void 0===F?null:F,C=u.max,T=void 0===C?null:C,g=u.minLength,b=void 0===g?null:g,O=u.maxLength,L=void 0===O?null:O,S=u.extensions,M=void 0===S?[]:S,A=u.accept,D=void 0===A?null:A,k=u.maxSize,N=void 0===k?null:k,x=u.validate,V=void 0===x?[]:x;if(f&&!r)o.push(this.createValidationError("required"));else if(null!=E&&E instanceof RegExp&&!E.test(r))o.push(this.createValidationError("pattern",{value:r,pattern:E}));else if(null==E||new RegExp(E).test(r))if(null!=v){var w=this.state.forms[e];w&&w.values[v]!=r&&o.push(this.createValidationError("match",{value:r,match:v}))}else"email"!==p||EMAIL_REGEX.test(r)||o.push(this.createValidationError("email",{value:r})),"number"===p?(R&&!INTEGER_REGEX.test(r)&&o.push(this.createValidationError("integer",{value:r})),R||FLOAT_REGEX.test(r)||o.push(this.createValidationError("float",{value:r})),null!=y&&+r<y&&o.push(this.createValidationError("min",{value:r,min:y})),null!=T&&+r>T&&o.push(this.createValidationError("max",{value:r,max:T}))):"file"===p&&n&&n.length?n.forEach(function(e){M&&M.length?M.filter(function(t){return new RegExp("\\."+t.replace(/\./,"")+"$","i").test(e.name)}).length||o.push(i.createValidationError("extension",{value:r,file:e,extensions:M})):D&&(D.replace(/ /g,"").split(",").filter(function(t){return new RegExp("^"+t.replace(/\*/g,".*")+"$").test(e.type)}).length||o.push(i.createValidationError("accept",{value:r,file:e,accept:D}))),null!=N&&e.size>+N&&o.push(i.createValidationError("maxSize",{value:r,file:e,maxSize:N}))}):(null!=b&&r&&r.length<b&&o.push(this.createValidationError("minLength",{value:r,minLength:b})),null!=L&&r&&r.length>L&&o.push(this.createValidationError("maxLength",{value:r,maxLength:L}))),V.length&&Object.keys(s).length&&V.forEach(function(e){var t=e,a=_extends({value:r},e.params);"object"===(void 0===e?"undefined":_typeof(e))&&(t=e.name);var l=s[t];l&&!l(r,a,n)&&o.push(i.createValidationError(t,a))});else o.push(this.createValidationError("pattern",{value:r,pattern:E}));t.value=r,t.errors=o,t.unchanged=r===l,t.changed=r!==l,t.valid=0===o.length,t.invalid=o.length>0}},{key:"onFormSubmited",value:function(e,t){this.setState(function(r){var n=r.forms[e];return n&&FormEventDispatcher.forwardSubmitFormEvent(e,n.values,n,t),r})}},{key:"onFormReseted",value:function(e){var t=this;this.setState(function(r){var n=_extends({},r.forms)[e];return Object.keys(n.fields).forEach(function(r){var i=n.fields[r];t.updateFieldCtrl(e,i,i.initialValue),i.touched=!1,i.untouched=!0,i.dirty=!1,i.pristine=!0,FormEventDispatcher.forwardFieldChangedEvent(e,r,i),n.values[r]=i.initialValue}),t.updateFormCtrl(e,n),r})}},{key:"unsubscribe",value:function(){document.removeEventListener(REACT_FORMCTRL.EVENTS.REGISTER_FORM,this.onEvent),document.removeEventListener(REACT_FORMCTRL.EVENTS.REGISTER_FIELD,this.onEvent),document.removeEventListener(REACT_FORMCTRL.EVENTS.UNREGISTER_FORM,this.onEvent),document.removeEventListener(REACT_FORMCTRL.EVENTS.UNREGISTER_FIELD,this.onEvent),document.removeEventListener(REACT_FORMCTRL.EVENTS.FIELD_CHANGED,this.onEvent),document.removeEventListener(REACT_FORMCTRL.EVENTS.FIELD_BLURRED,this.onEvent),document.removeEventListener(REACT_FORMCTRL.EVENTS.FIELD_PROPS_CHANGED,this.onEvent),document.removeEventListener(REACT_FORMCTRL.EVENTS.FORM_SUBMITED,this.onEvent),document.removeEventListener(REACT_FORMCTRL.EVENTS.FORM_RESETED,this.onEvent)}},{key:"render",value:function(){return this.props.children}}]),t}(_react2.default.Component);FormProvider.propTypes={customValidators:_propTypes2.default.arrayOf(_propTypes2.default.shape({name:_propTypes2.default.string.isRequired,validate:_propTypes2.default.func.isRequired}))};